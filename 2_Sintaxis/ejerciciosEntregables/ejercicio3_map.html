<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
    <title>Map en JS</title>
</head>
<body>
    <div class="container-md">
        <table id="tabla" class="table">
            <theader>
                <th>Nombre</th>
                <th>Nº Habitantes</th>
            </theader>
            <tbody id="cuerpo">
                
            </tbody>
        </table>
    </div>
    
    <div class="container-sm">
        <button class="btn btn-primary mb-1" onclick="cargar();">Cargar</button>
        <br>
        <button class="btn btn-danger mb-1" 
            onclick="eliminarTodo()">
            Borrar todo
        </button>
        <br>
        <button class="btn btn-primary mb-1" 
            onclick="eliminar(document.getElementById('borrar').value)">
            Eliminar
        </button>
        <label class="m-1">Ciudad a eliminar: <input id="borrar"></label>
        <br>
        <button class="btn btn-primary mb-1" 
            onclick="anadir(document.getElementById('anadir').value, document.getElementById('numHabitantes').value)">
            Añadir/Modificar
        </button>
        <label class="m-1">Nombre: <input id="anadir"></label>
        <label class="m-1">Nº habitantes: <input type= "number" id="numHabitantes"></label>
        <br>
        <button class="btn btn-primary mb-1" onclick="mayor();">Mayor nº de habitantes</button>
        <br>
        <button class="btn btn-primary mb-1" onclick="menor();">Menor nº de habitantes</button>
    </div>
    
    <script>
        let ciudades = new Map();
        
        ciudades.set("Cádiz", 110914);
        ciudades.set("El Puerto de Santa María", 89960);
        ciudades.set("Puerto Real", 42151);
        ciudades.set("Chiclana de la Frontera", 89794);
        ciudades.set("San Fernando", 93645);
        ciudades.set("Jerez de la Frontera", 213688);
        
        let [numHabitantes] = ciudades.values();
        let [nombreCiudades] = ciudades.keys();
        menorNumCiudad = [numHabitantes][0];
        menorNombreCiudad = [nombreCiudades][0];
        maxNumCiudad = [numHabitantes][0];
        maxNombreCiudad = [nombreCiudades][0];
        
        cargar = () => {
            let table = document.createElement('tbody');
            table.id = "cuerpo";
            
            ciudades.forEach( (numHabitantes, ciudad, ciudades) => {
                let row = table.insertRow(0);
                
                let cell1 = row.insertCell(0);
                let cell2 = row.insertCell(1);
                
                
                
                // Add some text to the new cells:
                cell1.innerHTML = ciudad;
                cell2.innerHTML = numHabitantes; 
            
            })
            document.getElementById("tabla").replaceChild(table, cuerpo);
        }
        
        window.addEventListener('DOMContentLoaded', cargar);
        
        eliminarTodo = () => {
            ciudades.clear();
            cargar();
        }
        
        eliminar = (nombreBorrar) => {
            console.log("Ciudad a borrar: " + nombreBorrar);
            if (nombreBorrar == "") {
                alert("No se ha introducido ciudad");
            } else if (!ciudades.has(nombreBorrar)) {
                alert(nombreBorrar + " no existe");
            }
            ciudades.delete(nombreBorrar);
            cargar();
        }
        
        anadir = (nombreAnadir, numHabitantes) => {
            console.log("Nombre a añadir: " + nombreAnadir);
            console.log("Nº Habitantes a añadir: " + numHabitantes);
            if (nombreAnadir == null || numHabitantes == null || nombreAnadir == "" || numHabitantes == "" || numHabitantes < 0){
                alert("Introduce datos válidos");
            } else if (ciudades.has(nombreAnadir) && ciudades.get(nombreAnadir) == numHabitantes){
                alert(nombreAnadir + " ya tiene " + numHabitantes + " habitantes");
            } else {
                ciudades.set(nombreAnadir, numHabitantes);
                cargar();
            }
        }
        
        menor = () => {
            let table = document.getElementById('cuerpo');
            console.log(table);
            
            // Si no existen ciudades, alertamos y salimos de la función
            if (ciudades.size == 0){
                alert("No existen ciudades")
                return "Not found";
            }
            
            // Forma de pasar de valores de Map a array ->
            // https://stackoverflow.com/questions/32373301/first-item-from-a-map-on-javascript-es2015
            // let [numHabitantes] = ciudades.values();
            // let [nombreCiudades] = ciudades.keys();
            // menorNumCiudad = [numHabitantes][0];
            // menorNombreCiudad = [nombreCiudades][0];
            
            ciudades.forEach( (numHabitantes, ciudad, ciudades) => {
                if (numHabitantes < menorNumCiudad){
                    menorNumCiudad = numHabitantes;
                    menorNombreCiudad = ciudad;
                }
            });
            
            console.log("Nombre de la menor ciudad: " + menorNombreCiudad);
            console.log("Nº habitantes de la ciudad: " + menorNumCiudad);
            
            // Para añadir el texto verde y en negrita:
            // td.setAttribute('class', 'className');
            // ó
            // td.childNodes[0].classList.add("text-success","fw-bold");
            table.childNodes.forEach(fila => {
                // console.log(fila);
                // console.log(fila.childNodes[0]);
                if (fila.childNodes[0].innerHTML === menorNombreCiudad){
                    // console.log("Ciudad encontrada")
                    fila.childNodes[0].classList.add("text-success","fw-bold");
                    //fila.childNodes[0].setAttribute('class', 'text-success fw-bold');
                }
            });
        }
        
        mayor = () => {
            let table = document.getElementById('cuerpo');
            console.log(table);
            
            // Si no existen ciudades, alertamos y salimos de la función
            if (ciudades.size == 0){
                alert("No existen ciudades")
                return "Not found";
            }
            
            // Forma de pasar de valores de Map a array ->
            // https://stackoverflow.com/questions/32373301/first-item-from-a-map-on-javascript-es2015
            // let [numHabitantes] = ciudades.values();
            // let [nombreCiudades] = ciudades.keys();
            // maxNumCiudad = [numHabitantes][0];
            // maxNombreCiudad = [nombreCiudades][0];
            
            ciudades.forEach( (numHabitantes, ciudad, ciudades) => {
                if (numHabitantes > maxNumCiudad){
                    maxNumCiudad = numHabitantes;
                    maxNombreCiudad = ciudad;
                }
            });
            
            console.log("Nombre de la mayor ciudad: " + maxNombreCiudad);
            console.log("Nº habitantes de la ciudad: " + maxNumCiudad);
            
            // Para añadir el texto verde y en negrita:
            // td.setAttribute('class', 'className');
            // ó
            // td.childNodes[0].classList.add("text-success","fw-bold");
            table.childNodes.forEach(fila => {
                // console.log(fila);
                // console.log(fila.childNodes[0]);
                if (fila.childNodes[0].innerHTML === maxNombreCiudad){
                    // console.log("Ciudad encontrada")
                    fila.childNodes[0].classList.add("text-danger","fw-bold");
                    //fila.childNodes[0].setAttribute('class', 'text-success fw-bold');
                }
            });
        }
        
    </script>
</body>
</html>
